(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(t,e,n){t.exports=n(220)},127:function(t,e,n){},129:function(t,e,n){},137:function(t,e){},139:function(t,e){},172:function(t,e){},173:function(t,e){},220:function(t,e,n){"use strict";n.r(e);var a=n(2),i=n.n(a),r=n(97),o=n.n(r),s=n(38),h=n(8),c=n(9),u=n(19),l=n(18),d=n(20),m=n(5),g=n(98),f=n.n(g);function b(t,e,n,a){var i;return{MozTransform:i="scale("+(t?"-":"")+e+", "+e+")",WebkitTransform:i,OTransform:i,transform:i}}var p=function(t){function e(t){var n;return Object(h.a)(this,e),(n=Object(u.a)(this,Object(l.a)(e).call(this,t))).fileInput=i.a.createRef(),n.onChoosePhoto=n.onChoosePhoto.bind(Object(m.a)(Object(m.a)(n))),n}return Object(d.a)(e,t),Object(c.a)(e,[{key:"onChoosePhoto",value:function(){this.fileInput.click()}},{key:"calculateScaleLeftTop",value:function(){var t=this.props.videoConstraints,e=this.props.faceBox,n=.45*this.props.viewport.height,a=.8*this.props.viewport.height,i=t.width/2,r=t.height/2,o=Math.max(n/t.width,a/t.height),s=n/e.width,h=Math.max(o,s),c=e.x-i,u=e.y-r,l=-t.width/2-c*h,d=-t.height/2-u*h+a/6,m=t.width/2*(h-1),g=t.height/2*(h-1),f=-(t.height+g-a),b=g,p=-(t.width+m-n),v=m,w=Math.min(Math.max(l,p),v),x=Math.min(Math.max(d,f),b);return console.log(h+" "+w+" "+x),{scale:h,left:w,top:x}}},{key:"render",value:function(){var t=this,e=this.props.videoConstraints,n=this.props.faceBox,a=.45*this.props.viewport.height,r=.8*this.props.viewport.height,o=this.calculateScaleLeftTop(),h=o.scale,c=o.left,u=o.top,l=i.a.createElement("div",{className:"face-box",style:{position:"absolute",height:Math.min(n.height*h-6,r),width:Math.min(n.width*h-6,a),top:r/6,left:0}});return i.a.createElement("div",{className:"main-div"},i.a.createElement("div",{className:"typography"},"Add photo"),i.a.createElement("div",{className:"webcam-div"},i.a.createElement(f.a,{style:Object(s.a)({top:u,left:c},b(this.props.mirror,h)),className:"webcam-video",audio:!1,imageSmoothing:!0,height:e.height,width:e.width,ref:this.props.setRef,screenshotFormat:"image/jpeg",screenshotQuality:1,videoConstraints:e,onUserMedia:this.props.onUserMedia})),l,i.a.createElement("div",{className:"oval-container"},i.a.createElement("div",{className:"oval"})),i.a.createElement("div",{className:"vl"}),i.a.createElement("div",{className:"hl"}),i.a.createElement("input",{className:"fileInput",type:"file",onChange:this.props.handlePhotoChoose,ref:function(e){return t.fileInput=e}}),i.a.createElement("button",{className:"secondary-button photo-button",onClick:this.onChoosePhoto}),i.a.createElement("button",{className:"main-button",onClick:this.props.onCapture},"Pick photo"),i.a.createElement("button",{className:"next-button next-button",onClick:this.props.onNext}))}}]),e}(i.a.Component),v=n(99),w=n.n(v),x=(n(127),function(t){function e(t){var n;return Object(h.a)(this,e),(n=Object(u.a)(this,Object(l.a)(e).call(this,t))).onNext=n.onNext.bind(Object(m.a)(Object(m.a)(n))),n}return Object(d.a)(e,t),Object(c.a)(e,[{key:"onNext",value:function(){console.log("next")}},{key:"render",value:function(){return i.a.createElement("div",{className:"main-div"},i.a.createElement("div",{className:"typography"},"Confirm photo"),i.a.createElement("img",{className:"check-photo-img",src:this.props.imageSrc}),i.a.createElement("button",{className:"secondary-button back-button",onClick:this.props.onBack}),i.a.createElement("button",{className:"main-button",onClick:this.props.onConfirm},"Confirm"),i.a.createElement("button",{className:"next-button next-button",onClick:this.onNext}))}}]),e}(i.a.Component)),y=(n(129),function(t){function e(){return Object(h.a)(this,e),Object(u.a)(this,Object(l.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return i.a.createElement("label",{className:"checkbox"},this.props.label,i.a.createElement("input",{type:"checkbox",checked:this.props.value,onChange:this.props.onChange}),i.a.createElement("span",{className:"checkmark"}))}}]),e}(i.a.Component));y.defaultProps={value:!1,label:""};var C=n(12),k=n.n(C),O=n(21),j=n(100),E=new(function(){function t(){Object(h.a)(this,t)}return Object(c.a)(t,[{key:"mirrorImage",value:function(t){var e=function(t){var e=[];return t.forEach(function(t){return e.push(t.r,t.g,t.b,t.a)}),e}(function(t){for(var e=[],n=0;n<t.length;++n)e.push.apply(e,Object(j.a)(t[n]));return e}(function(t){for(var e=0;e<t.length;++e)t[e]=t[e].reverse();return t}(function(t,e,n){for(var a=new Array(n),i=0;i<n;++i)a[i]=t.slice(i*e,(i+1)*e);return a}(function(t){for(var e=new Array(t.length/4),n=0;n<t.length/4;n++)e[n]={r:t[4*n],g:t[4*n+1],b:t[4*n+2],a:t[4*n+3]};return e}(t.data),t.width,t.height))));return new ImageData(new Uint8ClampedArray(e),t.width,t.height)}}]),t}());var F=new(function(){function t(){Object(h.a)(this,t),this.set=new Set,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.img=new Image,this.finishMirroring=this.finishMirroring.bind(this)}return Object(c.a)(t,[{key:"captureAndMirrorImage",value:function(t,e){this.set.add(e),this.img.onload=this.finishMirroring,this.img.src=t.getScreenshot()}},{key:"finishMirroring",value:function(){var t=Object(O.a)(k.a.mark(function t(){var e,n,a,i,r,o,s;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(this.canvas.width=this.img.width,this.canvas.height=this.img.height,this.ctx.drawImage(this.img,0,0),e=this.ctx.getImageData(this.img.x,this.img.y,this.img.width,this.img.height),n=E.mirrorImage(e),this.ctx.putImageData(n,0,0,0,0,e.width,e.height),a=!0,i=!1,r=void 0,t.prev=9,o=this.set[Symbol.iterator]();!(a=(s=o.next()).done);a=!0)(0,s.value)(this.canvas.toDataURL());t.next=17;break;case 13:t.prev=13,t.t0=t.catch(9),i=!0,r=t.t0;case 17:t.prev=17,t.prev=18,a||null==o.return||o.return();case 20:if(t.prev=20,!i){t.next=23;break}throw r;case 23:return t.finish(20);case 24:return t.finish(17);case 25:this.set.clear();case 26:case"end":return t.stop()}},t,this,[[9,13,17,25],[18,,20,24]])}));return function(){return t.apply(this,arguments)}}()}]),t}()),I=n(23),M=new(function(){function t(){Object(h.a)(this,t),this.faceDetection=this.faceDetection.bind(this),this.detectFace=this.detectFace.bind(this),this.getFullFaceDescription=this.getFullFaceDescription.bind(this)}return Object(c.a)(t,[{key:"loadModels",value:function(){var t=Object(O.a)(k.a.mark(function t(){var e;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e="./models",t.next=3,I.d(e);case 3:return t.next=5,I.e(e);case 5:return t.next=7,I.b(e);case 7:return t.next=9,I.c(e);case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"faceDetection",value:function(t,e,n,a){this.setFaceBox=n,this.callback=a,t?F.captureAndMirrorImage(e,this.detectFace):this.detectFace(e.getScreenshot())}},{key:"detectFace",value:function(){var t=Object(O.a)(k.a.mark(function t(e){var n=this;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getFullFaceDescription(e).then(function(t){t&&t.detection&&n.setFaceBox({x:t.detection.box.x,y:t.detection.box.y,width:t.detection.box.width,height:t.detection.box.height}),n.callback()});case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getFullFaceDescription",value:function(){var t=Object(O.a)(k.a.mark(function t(e){var n,a,i;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I.a(e);case 2:return n=t.sent,a={minFaceSize:100},t.next=6,I.f(n,a);case 6:return i=t.sent,t.abrupt("return",i[0]);case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}());var S,N,R,B=[{width:160,height:120},{width:320,height:180},{width:320,height:240},{width:640,height:360},{width:640,height:480},{width:768,height:576},{width:1024,height:576},{width:1280,height:720},{width:1280,height:768},{width:1280,height:800},{width:1280,height:900},{width:1280,height:1e3},{width:1920,height:1080},{width:1920,height:1200},{width:2560,height:1440},{width:3840,height:2160},{width:4096,height:2160}],P=0,D=B.length;function A(){return T.apply(this,arguments)}function T(){return(T=Object(O.a)(k.a.mark(function t(){var e;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("left = ",P,", right = ",D),!(P>D)){t.next=4;break}return console.log("Selected Height:Width = ",S,":",N),t.abrupt("return",{height:N,width:S});case 4:return R=Math.floor((P+D)/2),e={video:{mandatory:{minWidth:B[R].width,minHeight:B[R].height,maxWidth:B[R].width,maxHeight:B[R].height}}},t.abrupt("return",navigator.mediaDevices.getUserMedia(e).then(function(t){console.log("Success for --\x3e ",R," ",B[R]),S=B[R].width,N=B[R].height,P=R+1;var e=!0,n=!1,a=void 0;try{for(var i,r=t.getTracks()[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){i.value.stop()}}catch(o){n=!0,a=o}finally{try{e||null==r.return||r.return()}finally{if(n)throw a}}return A()}).catch(function(t){return console.log("Failed for --\x3e "+R," ",B[R]," ",t),D=R-1,A()}));case 7:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}var L=new(function(){function t(){Object(h.a)(this,t),this.set=new Set,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.img=new Image,this.cutPart=this.cutPart.bind(this)}return Object(c.a)(t,[{key:"getPartOfAnImage",value:function(t,e,n,a,i,r){this.set.add(r),this.subImage={x:e,y:n,width:a,height:i},this.img.onload=this.cutPart,this.img.src=t}},{key:"cutPart",value:function(){this.canvas.width=this.img.width,this.canvas.height=this.img.height,this.ctx.drawImage(this.img,0,0,640,480,this.subImage.x,this.subImage.y,this.subImage.width,this.subImage.height);var t=!0,e=!1,n=void 0;try{for(var a,i=this.set[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){(0,a.value)(this.canvas.toDataURL())}}catch(r){e=!0,n=r}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}}}]),t}()),U=Math.max(document.documentElement.clientWidth,window.innerWidth||0),W=Math.max(document.documentElement.clientHeight,window.innerHeight||0),z=function(t){function e(t){var n;return Object(h.a)(this,e),(n=Object(u.a)(this,Object(l.a)(e).call(this,t))).setRef=function(t){return n.webcam=t},n.webcam=null,n.state={imageSrc:null,mirror:!0,handling:!0,faceBox:{x:0,y:0,width:.45*W,height:.4*W},videoConstraints:{width:640,height:480,frameRate:60,facingMode:"user"},viewport:{width:U,height:W}},n.handleResize=n.handleResize.bind(Object(m.a)(Object(m.a)(n))),n.setRef=n.setRef.bind(Object(m.a)(Object(m.a)(n))),n.onCapture=n.onCapture.bind(Object(m.a)(Object(m.a)(n))),n.onConfirm=n.onConfirm.bind(Object(m.a)(Object(m.a)(n))),n.onBack=n.onBack.bind(Object(m.a)(Object(m.a)(n))),n.setImage=n.setImage.bind(Object(m.a)(Object(m.a)(n))),n.setFaceBox=n.setFaceBox.bind(Object(m.a)(Object(m.a)(n))),n.setVideoConstraintsResolution=n.setVideoConstraintsResolution.bind(Object(m.a)(Object(m.a)(n))),n.onMirrorChange=n.onMirrorChange.bind(Object(m.a)(Object(m.a)(n))),n.handlingCurrentFrame=n.handlingCurrentFrame.bind(Object(m.a)(Object(m.a)(n))),n.handlePhotoChoose=n.handlePhotoChoose.bind(Object(m.a)(Object(m.a)(n))),n}return Object(d.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),A().then(this.setVideoConstraintsResolution),M.loadModels().then(this.handlingCurrentFrame)}},{key:"handleResize",value:function(){this.setState({viewport:{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}})}},{key:"handlingCurrentFrame",value:function(){this.state.handling&&this.webcam&&M.faceDetection(this.state.mirror,this.webcam,this.setFaceBox,this.handlingCurrentFrame)}},{key:"onCapture",value:function(){var t=this.webcam.getScreenshot();L.getPartOfAnImage(t,0,0,300,300,this.setImage),this.setState({handling:!1})}},{key:"onConfirm",value:function(){w.a.post("/addImage",this.state.imageSrc),console.log(this.state.imageSrc)}},{key:"onBack",value:function(){this.setState({handling:!0}),this.setImage(null),setTimeout(this.handlingCurrentFrame,3e3)}},{key:"onMirrorChange",value:function(t){this.setState({mirror:t.target.checked})}},{key:"setFaceBox",value:function(t){this.isFarFromCurrent(t)&&this.setState({faceBox:t})}},{key:"setVideoConstraintsResolution",value:function(t){this.setState({videoConstraints:Object(s.a)({},this.state.videoConstraints,t)})}},{key:"isFarFromCurrent",value:function(t){return Math.abs(t.x-this.state.faceBox.x)>20||Math.abs(t.y-this.state.faceBox.y)>20}},{key:"setImage",value:function(t){this.setState({imageSrc:t})}},{key:"handlePhotoChoose",value:function(t){var e=this;t.preventDefault();var n=new FileReader,a=t.target.files[0];n.onloadend=function(){return e.setImage(n.result)},n.readAsDataURL(a)}},{key:"render",value:function(){var t=i.a.createElement(x,{videoConstraints:this.state.videoConstraints,imageSrc:this.state.imageSrc,onConfirm:this.onConfirm,onBack:this.onBack}),e=i.a.createElement(p,Object.assign({webcam:this.webcam,setRef:this.setRef},this.state,{onUserMedia:this.handlingCurrentFrame(),onCapture:this.onCapture,onNext:this.handlingCurrentFrame,handlePhotoChoose:this.handlePhotoChoose,setLeftInfo:this.setLeftInfo,setTopInfo:this.setTopInfo}));return i.a.createElement("div",{style:{display:"flex",width:"100%",justifyContent:"center"}},i.a.createElement("div",null,this.state.imageSrc?t:e,i.a.createElement("h4",{style:{width:.45*W}},"If you don't see video stream, check if smth else using your webcamera. Also i'm working on browser compatibility)")),i.a.createElement(y,{value:this.state.mirror,onChange:this.onMirrorChange,label:"mirror"}))}}]),e}(i.a.Component);o.a.render(i.a.createElement(z,null),document.getElementById("root"))}},[[101,2,1]]]);
//# sourceMappingURL=main.f99c0b03.chunk.js.map