(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(t,e,a){t.exports=a(220)},127:function(t,e,a){},129:function(t,e,a){},137:function(t,e){},139:function(t,e){},172:function(t,e){},173:function(t,e){},220:function(t,e,a){"use strict";a.r(e);var n=a(2),i=a.n(n),r=a(97),o=a.n(r),s=a(38),h=a(8),c=a(9),u=a(19),l=a(18),d=a(20),m=a(5),g=a(98),f=a.n(g);function p(t,e,a,n){var i;return{MozTransform:i="scale("+(t?"-":"")+e+", "+e+")",WebkitTransform:i,OTransform:i,transform:i}}var b=function(t){function e(t){var a;return Object(h.a)(this,e),(a=Object(u.a)(this,Object(l.a)(e).call(this,t))).fileInput=i.a.createRef(),a.onChoosePhoto=a.onChoosePhoto.bind(Object(m.a)(Object(m.a)(a))),a}return Object(d.a)(e,t),Object(c.a)(e,[{key:"onChoosePhoto",value:function(){this.fileInput.click()}},{key:"calculateScaleLeftTop",value:function(){var t=this.props.videoConstraints,e=this.props.faceBox,a=.45*this.props.viewport.height,n=.8*this.props.viewport.height,i=t.width/2,r=t.height/2,o=Math.max(a/t.width,n/t.height),s=a/e.width,h=Math.max(o,s),c=e.x-i,u=e.y-r,l=-t.width/2-c*h,d=-t.height/2-u*h+n/6,m=t.width/2*(h-1),g=t.height/2*(h-1),f=-(t.height+g-n),p=g,b=-(t.width+m-a),v=m,w=Math.min(Math.max(l,b),v),C=Math.min(Math.max(d,f),p);return console.log(h+" "+w+" "+C),console.log("faceBoxWidth = "+e.width),console.log(),{scale:h,left:w,top:C}}},{key:"render",value:function(){var t=this,e=this.props.videoConstraints,a=this.props.faceBox,n=.45*this.props.viewport.height,r=.8*this.props.viewport.height,o=this.calculateScaleLeftTop(),h=o.scale,c=o.left,u=o.top,l=i.a.createElement("div",{className:"face-box",style:{position:"absolute",height:Math.min(a.height*h-6,r),width:Math.min(a.width*h-6,n),top:r/6,left:0}});return i.a.createElement("div",{className:"main-div"},i.a.createElement("div",{className:"typography"},"Add photo"),i.a.createElement("div",{className:"webcam-div"},i.a.createElement(f.a,{style:Object(s.a)({top:u,left:c},p(this.props.mirror,h)),className:"webcam-video",audio:!1,imageSmoothing:!0,height:e.height,width:e.width,ref:this.props.setRef,screenshotFormat:"image/jpeg",screenshotQuality:1,videoConstraints:e,onUserMedia:this.props.onUserMedia})),l,i.a.createElement("div",{className:"oval-container"},i.a.createElement("div",{className:"oval"})),i.a.createElement("div",{className:"vl"}),i.a.createElement("div",{className:"hl"}),i.a.createElement("input",{className:"fileInput",type:"file",onChange:this.props.handlePhotoChoose,ref:function(e){return t.fileInput=e}}),i.a.createElement("button",{className:"secondary-button photo-button",onClick:this.onChoosePhoto}),i.a.createElement("button",{className:"main-button",onClick:this.props.onCapture},"Pick photo"),i.a.createElement("button",{className:"next-button next-button",onClick:this.props.onNext}))}}]),e}(i.a.Component),v=a(99),w=a.n(v),C=(a(127),function(t){function e(t){var a;return Object(h.a)(this,e),(a=Object(u.a)(this,Object(l.a)(e).call(this,t))).onNext=a.onNext.bind(Object(m.a)(Object(m.a)(a))),a}return Object(d.a)(e,t),Object(c.a)(e,[{key:"onNext",value:function(){console.log("next")}},{key:"render",value:function(){return i.a.createElement("div",{className:"main-div"},i.a.createElement("div",{className:"typography"},"Confirm photo"),i.a.createElement("img",{className:"check-photo-img",src:this.props.imageSrc}),i.a.createElement("button",{className:"secondary-button back-button",onClick:this.props.onBack}),i.a.createElement("button",{className:"main-button",onClick:this.props.onConfirm},"Confirm"),i.a.createElement("button",{className:"next-button next-button",onClick:this.onNext}))}}]),e}(i.a.Component)),x=(a(129),function(t){function e(){return Object(h.a)(this,e),Object(u.a)(this,Object(l.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return i.a.createElement("label",{className:"checkbox"},this.props.label,i.a.createElement("input",{type:"checkbox",checked:this.props.value,onChange:this.props.onChange}),i.a.createElement("span",{className:"checkmark"}))}}]),e}(i.a.Component));x.defaultProps={value:!1,label:""};var y=a(12),j=a.n(y),k=a(21),O=a(100),F=new(function(){function t(){Object(h.a)(this,t)}return Object(c.a)(t,[{key:"mirrorImage",value:function(t){var e=function(t){var e=[];return t.forEach(function(t){return e.push(t.r,t.g,t.b,t.a)}),e}(function(t){for(var e=[],a=0;a<t.length;++a)e.push.apply(e,Object(O.a)(t[a]));return e}(function(t){for(var e=0;e<t.length;++e)t[e]=t[e].reverse();return t}(function(t,e,a){for(var n=new Array(a),i=0;i<a;++i)n[i]=t.slice(i*e,(i+1)*e);return n}(function(t){for(var e=new Array(t.length/4),a=0;a<t.length/4;a++)e[a]={r:t[4*a],g:t[4*a+1],b:t[4*a+2],a:t[4*a+3]};return e}(t.data),t.width,t.height))));return new ImageData(new Uint8ClampedArray(e),t.width,t.height)}}]),t}());var I=new(function(){function t(){Object(h.a)(this,t),this.set=new Set,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.img=new Image,this.finishMirroring=this.finishMirroring.bind(this)}return Object(c.a)(t,[{key:"captureAndMirrorImage",value:function(t,e){this.set.add(e),this.img.onload=this.finishMirroring,this.img.src=t.getScreenshot()}},{key:"finishMirroring",value:function(){var t=Object(k.a)(j.a.mark(function t(){var e,a,n,i,r,o,s;return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(this.canvas.width=this.img.width,this.canvas.height=this.img.height,this.ctx.drawImage(this.img,0,0),e=this.ctx.getImageData(this.img.x,this.img.y,this.img.width,this.img.height),a=F.mirrorImage(e),this.ctx.putImageData(a,0,0,0,0,e.width,e.height),n=!0,i=!1,r=void 0,t.prev=9,o=this.set[Symbol.iterator]();!(n=(s=o.next()).done);n=!0)(0,s.value)(this.canvas.toDataURL());t.next=17;break;case 13:t.prev=13,t.t0=t.catch(9),i=!0,r=t.t0;case 17:t.prev=17,t.prev=18,n||null==o.return||o.return();case 20:if(t.prev=20,!i){t.next=23;break}throw r;case 23:return t.finish(20);case 24:return t.finish(17);case 25:this.set.clear();case 26:case"end":return t.stop()}},t,this,[[9,13,17,25],[18,,20,24]])}));return function(){return t.apply(this,arguments)}}()}]),t}()),M=a(23),E=new(function(){function t(){Object(h.a)(this,t),this.faceDetection=this.faceDetection.bind(this),this.detectFace=this.detectFace.bind(this),this.getFullFaceDescription=this.getFullFaceDescription.bind(this)}return Object(c.a)(t,[{key:"loadModels",value:function(){var t=Object(k.a)(j.a.mark(function t(){var e;return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e="./models",t.next=3,M.d(e);case 3:return t.next=5,M.e(e);case 5:return t.next=7,M.b(e);case 7:return t.next=9,M.c(e);case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"faceDetection",value:function(t,e,a,n){this.setFaceBox=a,this.callback=n,t?I.captureAndMirrorImage(e,this.detectFace):this.detectFace(e.getScreenshot())}},{key:"detectFace",value:function(){var t=Object(k.a)(j.a.mark(function t(e){var a=this;return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getFullFaceDescription(e).then(function(t){t&&t.detection&&a.setFaceBox({x:t.detection.box.x,y:t.detection.box.y,width:t.detection.box.width,height:t.detection.box.height}),a.callback()});case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getFullFaceDescription",value:function(){var t=Object(k.a)(j.a.mark(function t(e){var a,n,i;return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M.a(e);case 2:return a=t.sent,n={minFaceSize:100},t.next=6,M.f(a,n);case 6:return i=t.sent,t.abrupt("return",i[0]);case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}());var S,N,B,R=[{width:160,height:120},{width:320,height:180},{width:320,height:240},{width:640,height:360},{width:640,height:480},{width:768,height:576},{width:1024,height:576},{width:1280,height:720},{width:1280,height:768},{width:1280,height:800},{width:1280,height:900},{width:1280,height:1e3},{width:1920,height:1080},{width:1920,height:1200},{width:2560,height:1440},{width:3840,height:2160},{width:4096,height:2160}],D=0,A=R.length;function P(){return W.apply(this,arguments)}function W(){return(W=Object(k.a)(j.a.mark(function t(){var e;return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("left = ",D,", right = ",A),!(D>A)){t.next=4;break}return console.log("Selected Height:Width = ",S,":",N),t.abrupt("return",{height:N,width:S});case 4:return B=Math.floor((D+A)/2),e={video:{mandatory:{minWidth:R[B].width,minHeight:R[B].height,maxWidth:R[B].width,maxHeight:R[B].height}}},t.abrupt("return",navigator.mediaDevices.getUserMedia(e).then(function(t){console.log("Success for --\x3e ",B," ",R[B]),S=R[B].width,N=R[B].height,D=B+1;var e=!0,a=!1,n=void 0;try{for(var i,r=t.getTracks()[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){i.value.stop()}}catch(o){a=!0,n=o}finally{try{e||null==r.return||r.return()}finally{if(a)throw n}}return P()}).catch(function(t){return console.log("Failed for --\x3e "+B," ",R[B]," ",t),A=B-1,P()}));case 7:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}var H=new(function(){function t(){Object(h.a)(this,t),this.set=new Set,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.img=new Image,this.crop=this.crop.bind(this)}return Object(c.a)(t,[{key:"cropImage",value:function(t,e,a,n,i){this.set.add(i),this.subImage=e,this.rectWidth=a,this.rectHeight=n,this.img.onload=this.crop,this.img.src=t}},{key:"crop",value:function(){this.canvas.width=this.rectWidth,this.canvas.height=this.rectHeight,this.ctx.drawImage(this.img,this.subImage.x,this.subImage.y,this.subImage.width,this.subImage.height,0,0,this.rectWidth,this.rectHeight);var t=!0,e=!1,a=void 0;try{for(var n,i=this.set[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){(0,n.value)(this.canvas.toDataURL())}}catch(r){e=!0,a=r}finally{try{t||null==i.return||i.return()}finally{if(e)throw a}}}}]),t}()),T=Math.max(document.documentElement.clientWidth,window.innerWidth||0),L=Math.max(document.documentElement.clientHeight,window.innerHeight||0),U=function(t){function e(t){var a;return Object(h.a)(this,e),(a=Object(u.a)(this,Object(l.a)(e).call(this,t))).setRef=function(t){return a.webcam=t},a.webcam=null,a.state={imageSrc:null,mirror:!0,handling:!0,faceBox:{x:0,y:0,width:.45*L,height:.4*L},capturedFrame:{x:0,y:0,width:.45*L,height:.8*L},videoConstraints:{width:640,height:480,frameRate:60,facingMode:"user"},viewport:{width:T,height:L}},a.handleResize=a.handleResize.bind(Object(m.a)(Object(m.a)(a))),a.setRef=a.setRef.bind(Object(m.a)(Object(m.a)(a))),a.onCapture=a.onCapture.bind(Object(m.a)(Object(m.a)(a))),a.cropCapturedImage=a.cropCapturedImage.bind(Object(m.a)(Object(m.a)(a))),a.onConfirm=a.onConfirm.bind(Object(m.a)(Object(m.a)(a))),a.onBack=a.onBack.bind(Object(m.a)(Object(m.a)(a))),a.setImage=a.setImage.bind(Object(m.a)(Object(m.a)(a))),a.setFaceBoxAndCalculateCapturedFrame=a.setFaceBoxAndCalculateCapturedFrame.bind(Object(m.a)(Object(m.a)(a))),a.setVideoConstraintsResolution=a.setVideoConstraintsResolution.bind(Object(m.a)(Object(m.a)(a))),a.onMirrorChange=a.onMirrorChange.bind(Object(m.a)(Object(m.a)(a))),a.handlingCurrentFrame=a.handlingCurrentFrame.bind(Object(m.a)(Object(m.a)(a))),a.handlePhotoChoose=a.handlePhotoChoose.bind(Object(m.a)(Object(m.a)(a))),a}return Object(d.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),P().then(this.setVideoConstraintsResolution),E.loadModels().then(this.handlingCurrentFrame)}},{key:"handleResize",value:function(){this.setState({viewport:{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}})}},{key:"handlingCurrentFrame",value:function(){this.state.handling&&this.webcam&&E.faceDetection(this.state.mirror,this.webcam,this.setFaceBoxAndCalculateCapturedFrame,this.handlingCurrentFrame)}},{key:"onCapture",value:function(){this.state.mirror?I.captureAndMirrorImage(this.webcam,this.cropCapturedImage):this.cropCapturedImage(this.webcam.getScreenshot())}},{key:"cropCapturedImage",value:function(t){var e=.45*this.state.viewport.height,a=.8*this.state.viewport.height;H.cropImage(t,this.state.capturedFrame,e,a,this.setImage),this.setState({handling:!1})}},{key:"onConfirm",value:function(){w.a.post("/addImage",this.state.imageSrc),console.log(this.state.imageSrc)}},{key:"onBack",value:function(){this.setState({handling:!0}),this.setImage(null),setTimeout(this.handlingCurrentFrame,3e3)}},{key:"onMirrorChange",value:function(t){this.setState({mirror:t.target.checked})}},{key:"setFaceBoxAndCalculateCapturedFrame",value:function(t){var e,a,n=Math.min(this.state.videoConstraints.width,t.width),i=16*n/9;i>this.state.videoConstraints.height?a=(e=this.state.videoConstraints.height)/16*9:(a=n,e=i);var r=Math.min(Math.max(0,t.x),this.state.videoConstraints.width-t.width),o=Math.min(Math.max(0,t.y-e/6),this.state.videoConstraints.height-e);this.isFarFromCurrent(t)&&this.setState({faceBox:t,capturedFrame:{x:r,y:o,width:a,height:e}})}},{key:"setVideoConstraintsResolution",value:function(t){this.setState({videoConstraints:Object(s.a)({},this.state.videoConstraints,t)})}},{key:"isFarFromCurrent",value:function(t){return Math.abs(t.x-this.state.faceBox.x)>20||Math.abs(t.y-this.state.faceBox.y)>20}},{key:"setImage",value:function(t){this.setState({imageSrc:t})}},{key:"handlePhotoChoose",value:function(t){var e=this;t.preventDefault();var a=new FileReader,n=t.target.files[0];a.onloadend=function(){return e.setImage(a.result)},a.readAsDataURL(n)}},{key:"render",value:function(){var t=i.a.createElement(C,{videoConstraints:this.state.videoConstraints,imageSrc:this.state.imageSrc,onConfirm:this.onConfirm,onBack:this.onBack}),e=i.a.createElement(b,Object.assign({webcam:this.webcam,setRef:this.setRef},this.state,{onUserMedia:this.handlingCurrentFrame(),onCapture:this.onCapture,onNext:this.handlingCurrentFrame,handlePhotoChoose:this.handlePhotoChoose,setLeftInfo:this.setLeftInfo,setTopInfo:this.setTopInfo}));return i.a.createElement("div",{style:{display:"flex",width:"100%",justifyContent:"center"}},i.a.createElement("div",null,this.state.imageSrc?t:e,i.a.createElement("h4",{style:{width:.45*L}},"If you don't see video stream, check if smth else using your webcamera. Also i'm working on browser compatibility)")),i.a.createElement(x,{value:this.state.mirror,onChange:this.onMirrorChange,label:"mirror"}))}}]),e}(i.a.Component);o.a.render(i.a.createElement(U,null),document.getElementById("root"))}},[[101,2,1]]]);
//# sourceMappingURL=main.70a05b7e.chunk.js.map